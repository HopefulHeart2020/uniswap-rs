name: Test

on:
    push:
        branches:
            - master
    pull_request:

jobs:
    test:
        name: Test
        runs-on: ubuntu-latest

        steps:
            - name: Checkout sources
              uses: actions/checkout@v3

            - name: Install toolchain
              uses: actions-rs/toolchain@v1
              with:
                  toolchain: nightly
                  profile: minimal
                  override: true

            - uses: Swatinem/rust-cache@v1
              with:
                  cache-on-failure: true

            - name: Add problem matchers
              run: echo "::add-matcher::.github/matchers/rust.json"

            - name: Run tests
              uses: actions-rs/cargo@v1
              with:
                  command: test
                  args: --all --all-features
