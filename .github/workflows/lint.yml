name: Lint

on:
    push:
        branches:
            - master
    pull_request:

jobs:
    clippy:
        name: Clippy
        runs-on: ubuntu-latest

        steps:
            - name: Checkout sources
              uses: actions/checkout@v3

            - name: Install toolchain
              uses: actions-rs/toolchain@v1
              with:
                  toolchain: nightly
                  profile: minimal
                  components: rustfmt, clippy
                  override: true

            - uses: Swatinem/rust-cache@v1
              with:
                  cache-on-failure: true

            - name: cargo clippy
              uses: actions-rs/clippy-check@v1
              with:
                  args: --all --all-features -- -D warnings
                  token: ${{ secrets.GITHUB_TOKEN }}

    rustfmt:
        name: Format
        runs-on: ubuntu-latest

        steps:
            - name: Checkout sources
              uses: actions/checkout@v3

            - name: Install toolchain
              uses: actions-rs/toolchain@v1
              with:
                  toolchain: nightly
                  profile: minimal
                  components: rustfmt, clippy
                  override: true

            - uses: Swatinem/rust-cache@v1
              with:
                  cache-on-failure: true

            - name: cargo fmt
              uses: actions-rs/cargo@v1
              with:
                  command: fmt
                  args: --all --check
